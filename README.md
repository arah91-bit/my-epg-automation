# IPTV EPG Automation Suite

This project contains a collection of scripts designed to create a reliable, daily-updated Electronic Program Guide (EPG) for use with IPTV players like Jellyfin, Plex, or Emby.

It takes messy, public M3U playlists and automatically produces a clean playlist with only working streams and a comprehensive `guide.xml` file with accurate EPG data.

## Features

* **Centralized Configuration:** All paths and settings are managed in a single, easy-to-edit `config.ini` file.
* **Automatic Stream Checking:** It processes thousands of streams and filters out any dead or unresponsive links.
* **Intelligent Channel ID Correction:** It automatically corrects channel `tvg-id`s to match standardized formats, maximizing the amount of EPG data found.
* **EPG Source Analysis:** Includes a tool to analyze your channel list and automatically generate a curated list of the most relevant EPG provider sites.
* **Fully Automated Workflow:** A single master script runs the entire process from start to finish.

## Core Dependencies

Before you begin, you must have the following software installed and available in your system's PATH.

* **[Python 3](https://www.python.org/downloads/)**: For checking streams and cleaning channel IDs.
* **[Node.js](https://nodejs.org/)**: For running the core EPG grabber.
* **[Git](https://git-scm.com/)**: For cloning the required `iptv-org/epg` repository.
* **[FFmpeg](https://ffmpeg.org/)**: The `ffprobe.exe` tool is essential for checking if video streams are active.

## Setup Instructions

Follow these steps carefully to set up your environment. This is a one-time setup.

### Step 1: Set Up the Core EPG Grabber

This entire system is built around the `iptv-org/epg` project. You must clone their repository first.

```powershell
# Open PowerShell and navigate to your server directory
cd C:\server

# Clone the repository
git clone [https://github.com/iptv-org/epg.git](https://github.com/iptv-org/epg.git)

# Enter the new directory and install its Node.js dependencies
cd epg
npm install
```
This will create a `C:\server\epg` folder and install all the necessary packages for the grabber.

### Step 2: Add Project Files

Copy the following files from this repository into your `C:\server\epg\` folder:

* `Run_Full_EPG_Update.ps1` (The master script you run)
* `generate_cleaned_playlist.py` (The Python stream checker/cleaner)
* `epg_relevancy_analyzer.py` (The tool to find the best EPG sites)
* `config.ini` (Your central configuration file)
* `epgsites.txt` (The full list of all potential EPG sites)
* `m3ulinks.txt` (The file where you list your source M3U URLs)

### Step 3: Install Python Libraries

Open PowerShell and run the following commands to install the required Python packages:

```powershell
pip install requests
pip install thefuzz
pip install python-levenshtein
```

### Step 4: Configure `config.ini`

This is the **most important step**. Open `config.ini` in a text editor. This is the only file you should ever need to edit.

Review all the paths and settings, paying close attention to the `[Paths]` section to ensure they match your system's setup, especially the path to `ffprobe.exe`.

### Step 5: Prepare Your Source M3U Links

Open the `m3ulinks.txt` file. In this file, paste the URLs of the M3U playlists you want to process, with one URL per line.

## The Automated Workflow

Once setup is complete, here is how you use the system.

### Step 1: Find Your Best EPG Sites (One-Time Task)

Before your first run, you need to generate a curated list of the best EPG sites for your channels.

1.  Run the main Python script once to generate an initial `cleaned_playlist.m3u`:
    ```powershell
    python generate_cleaned_playlist.py
    ```
2.  Now, run the relevancy analyzer. It will read your new playlist and automatically create a `mysites.txt` file with the best EPG sources for you.
    ```powershell
    python epg_relevancy_analyzer.py
    ```

### Step 2: Run the Master Script (Daily Task)

This is the only command you need to run for your daily updates. It handles everything automatically.

```powershell
# Make sure you are in the correct directory
cd C:\server\epg

# Execute the master script
.\Run_Full_EPG_Update.ps1
```

The script will now perform the full process, and when it's finished, your `guide.xml` and `cleaned_playlist.m3u` files will be ready.

### Step 3: Use the Output Files

Point your IPTV client (Jellyfin, Plex, Emby, etc.) to the two final files generated by the script:
* **M3U Playlist:** `C:\server\epg\cleaned_playlist.m3u`
* **XMLTV Guide:** `C:\server\epg\guide.xml`

Your setup is now fully automated!
